(this["webpackJsonphb-frontend"]=this["webpackJsonphb-frontend"]||[]).push([[70],{1210:function(e,t,a){"use strict";a.r(t);var i=a(4),n=a(8),c=a(27),l=a(1),s=a(31),r=a(53),d=a(57),o=a(102),u=a.n(o),m=a(605),j=a(611),b=a(45),h=a(28),O=a(34),g=a(58),x=a(609),f=a(610),y=a(59),v=a(80),p=a(628),w=function(e){return f.b().shape({title:f.d().trim().required(""),summary:f.d().trim().required(""),source:f.d().trim().required("").matches(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/,"URL is invalid")})},N={title:"",summary:"",source:"",image:"",type:"text"},k=function(e){var t=Object(h.b)(),a=function(e,a){return t(Object(b.d)(e,a))},s=Object(l.useState)({url:"",name:""}),r=Object(c.a)(s,2),o=r[0],u=r[1],m=e.id,j=e.name,f=e.setArticles,k=e.handleClose,C=e.show,S=e.page,_=e.pageSize,A=Object(l.useRef)(null),D=Object(l.useRef)(null),z=function(e){var i=e.target.files[0];i&&(t(Object(v.c)()),a({api:"/api/v1/upload/image-article?file_name=".concat(i.name),method:"get"},(function(e){var a=e.status,n=e.data;if(a===b.c){var c=n.file_path.link,l=new Headers;l.append("x-amz-acl","public-read");var s={method:"PUT",headers:l,body:i,redirect:"follow"};fetch(n.link,s).then((function(e){return e.text()})).then((function(e){u({url:c,name:i.name}),t(Object(v.d)())})).catch((function(e){console.log(e),t(Object(v.d)())}))}else t(Object(v.d)())})))},T=Object(l.useState)(!1),R=Object(c.a)(T,2),B=R[0],P=R[1],L=function(){A.current.resetForm(),u({url:"",name:""}),P(!1),k()};return Object(i.jsx)("div",{className:"flex-row align-items-center",children:Object(i.jsxs)(d.D,{size:"lg",centered:!0,show:C,onClose:k,closeOnBackdrop:!1,children:[Object(i.jsxs)(d.G,{children:["Create new article",Object(i.jsx)("i",{className:"fa fa-close cursor-pointer",style:{color:"gray"},onClick:function(){A.current.dirty||o.name?P(!0):L()}})]}),Object(i.jsxs)(d.E,{children:[Object(i.jsxs)(d.D,{size:"sm",show:B,centered:!0,closeOnBackdrop:!1,children:[Object(i.jsx)(d.E,{style:{textAlign:"center"},children:"Are you sure you want to discard your changes?"}),Object(i.jsxs)(d.F,{style:{display:"flex",justifyContent:"space-around"},children:[Object(i.jsx)(d.d,{style:{width:120},color:"danger",onClick:L,children:"Discard"}),Object(i.jsx)(d.d,{style:{width:120},color:"primary",onClick:function(){return P(!1)},children:"Keep editing"})]})]}),Object(i.jsx)(x.a,{innerRef:A,enableReinitialize:!0,initialValues:N,validate:Object(y.q)(w),onSubmit:function(e){var t={title:e.title.trim(),summary:e.summary.trim(),source:e.source.trim(),image:o.url,type:e.type};a({method:"post",api:O.c.rest.adminCreateNewsfeedArticle(m),body:t,loading:!0},(function(e){e.status===b.c&&(f((function(e){var a=[Object(n.a)(Object(n.a)({},t),{},{created_date:(new Date).getTime()/1e3})].concat(Object(g.a)(e.data)).slice(0,_).map((function(e,t){return Object(n.a)(Object(n.a)({},e),{},{no:t+1+_*(S-1)})}));return Object(n.a)(Object(n.a)({},e),{},{data:a,total:e.total+1,totalPages:Math.ceil((e.total+1)/_),loading:!1})})),L())}))},children:function(e){var t=e.values,a=e.errors,n=e.touched,c=e.dirty,l=e.handleChange,s=e.handleSubmit,r=e.isValid,m=e.handleBlur;return Object(i.jsxs)(d.q,{onSubmit:s,children:[Object(i.jsx)(p.a,{label:"Title (*)",children:Object(i.jsx)(d.u,{type:"text",placeholder:"Title (*)",maxLength:100,invalid:""!==t.title.trim()&&n.title&&!!a.title,value:t.title,onChange:l,name:"title"})}),Object(i.jsx)(p.a,{label:"Summary (*)",children:Object(i.jsx)(d.Q,{type:"text",placeholder:"Summary (*)",rows:5,maxLength:1e3,invalid:""!==t.summary.trim()&&n.summary&&!!a.summary,value:t.summary,onChange:l,name:"summary"})}),Object(i.jsx)(p.a,{label:"Category",children:Object(i.jsx)(d.u,{value:j,disabled:!0})}),Object(i.jsx)(p.a,{label:"URL (*)",children:Object(i.jsxs)(d.r,{className:"m-0",children:[Object(i.jsx)(d.u,{placeholder:"URL (*)",invalid:""!==t.source.trim()&&n.source&&!!a.source,value:t.source,onChange:l,onBlur:m,name:"source"}),Object(i.jsx)(d.A,{className:"ml-2",children:a.source})]})}),Object(i.jsxs)(p.a,{label:"Image (*)",children:[Object(i.jsxs)("div",{className:"d-flex align-items-center",children:[Object(i.jsx)(d.d,{color:"primary",className:"mr-3",onClick:function(){return D.current.click()},disabled:!!o.name,style:{minWidth:120},children:"Upload image"}),Object(i.jsx)("div",{className:"ellipsis-1-line",children:o.name}),o.name&&Object(i.jsx)("i",{className:"fa fa-times-circle ml-2 cursor-pointer",style:{color:"gray",minWidth:30},onClick:function(){return u({url:"",name:""})}})]}),Object(i.jsx)("input",{type:"file",hidden:!0,ref:D,accept:"image/x-png,image/gif,image/jpeg",onChange:z})]}),Object(i.jsx)("div",{style:{textAlign:"right"},children:Object(i.jsx)(d.d,{color:"primary",className:"px-4",type:"submit",disabled:!(r&&c&&o.url),children:"Save"})})]})}})]})]})})},C=a(35),S=[{key:"no",_style:{width:"4%"}},{key:"title",_style:{width:"24%"}},{key:"summary",_style:{width:"30%"}},{key:"source",label:"Link",_style:{width:"24%"}},{key:"created_date",_style:{width:"10%"}},{key:"action",_style:{width:"10%"}}],_={show:!1,id:"",name:""};t.default=function(e){var t,a,o=Object(s.h)(),g=Object(h.b)(),x=function(e,t){return g(Object(b.d)(e,t))},f=null===(t=e.match)||void 0===t?void 0:t.params,y=null===f||void 0===f?void 0:f.id,v=new URLSearchParams(null===(a=e.location)||void 0===a?void 0:a.search),p=Math.max(Number(v.get("page"))||1,1),w=Object(l.useState)(""),N=Object(c.a)(w,2),A=N[0],D=N[1],z=Object(l.useState)(null),T=Object(c.a)(z,2),R=T[0],B=T[1],P=Object(l.useState)(null),L=Object(c.a)(P,2),q=L[0],U=L[1],M=(new Date,Object(l.useState)({data:[],total:0,totalPages:0,loading:!0,name:""})),Y=Object(c.a)(M,2),E=Y[0],V=Y[1],F=Object(l.useState)({show:!1,id:""}),W=Object(c.a)(F,2),G=W[0],H=W[1],I=Object(l.useState)(_),J=Object(c.a)(I,2),Z=J[0],K=J[1],Q=function(e,t){V(Object(n.a)(Object(n.a)({},E),{},{loading:!0})),x({method:"get",api:O.c.rest.adminGetNewsfeedArticles(y,e,t,R?R.getTime()/1e3:null,q?q.getTime()/1e3+86399:null)},(function(t){var a=t.status,i=t.data;a===b.c?(V({data:i.articles.map((function(t,a){return Object(n.a)(Object(n.a)({},t),{},{no:a+1+10*(e-1)})})),total:i.total,totalPages:Math.ceil(i.total/10),loading:!1,name:i.category_name}),p!==e&&o.push("?page=".concat(e))):V((function(e){return Object(n.a)(Object(n.a)({},e),{},{loading:!1})}))}))};Object(l.useEffect)((function(){Q(p,A)}),[R,q]);var X=Object(i.jsx)("div",{});return E.loading||E.total||(X=Object(i.jsx)("div",{children:"No items found"})),Object(i.jsxs)("div",{children:[Object(i.jsx)(k,Object(n.a)(Object(n.a)({},Z),{},{handleClose:function(){return K(_)},setArticles:V,page:p,pageSize:10})),Object(i.jsx)(m.b,{isVisible:G.show,title:"Delete Article",content:"Are you sure to delete this article?",leftButtonText:"No",rightButtonText:"Yes",leftButtonOnPress:function(){return H({show:!1,id:""})},rightButtonOnPress:function(){return e=G.id,H({show:!1,id:""}),V(Object(n.a)(Object(n.a)({},E),{},{loading:!0})),void x({method:"delete",api:O.c.rest.adminDeleteNewsfeedArticle(y,e)},(function(e){e.status===b.c&&Q(p,A)}));var e}}),Object(i.jsx)(r.a,{className:"pl-5 py-2 size-1",to:"/admin/newsfeed",children:"All Categories"}),Object(i.jsxs)("span",{className:"size-0 pl-2",children:["> ",E.name]}),Object(i.jsxs)("div",{className:"px-5 mt-3",children:[Object(i.jsxs)("div",{className:"d-flex align-items-center justify-content-between mt-4 mb-5",children:[Object(i.jsxs)("div",{className:"d-flex align-items-center",children:[Object(i.jsx)(j.a,{className:"mr-5",searchName:A,setSearchName:D,searchEmpty:!0,callbackSearch:function(e){return Q(1,e)}}),Object(i.jsx)("div",{children:"From date:"}),Object(i.jsx)("div",{children:Object(i.jsx)(m.e,{maxDate:q,date:R,setDate:B})}),Object(i.jsx)("div",{children:"To date:"}),Object(i.jsx)("div",{children:Object(i.jsx)(m.e,{minDate:R,date:q,setDate:U})})]}),Object(i.jsx)("div",{className:"d-flex align-items-center",children:Object(i.jsx)("button",{className:"btn btn-primary",onClick:function(){return K({show:!0,id:y,name:E.name})},disabled:E.loading&&0===E.data.length,children:"Create new article"})})]}),Object(i.jsx)("div",{style:{minHeight:"65vh"},children:Object(i.jsx)(d.l,{items:E.data,fields:S,loading:E.loading,noItemsViewSlot:X,hover:!0,striped:!0,scopedSlots:{no:function(e){return Object(i.jsx)("td",{className:"align-middle",children:e.no})},title:function(e){var t,a;return Object(i.jsx)("td",{className:"align-middle",title:(null===(t=e.summary)||void 0===t?void 0:t.length)>80?e.summary:"",children:e.title.length>80?(null===(a=e.title)||void 0===a?void 0:a.substring(0,77))+"...":null===e||void 0===e?void 0:e.title})},summary:function(e){var t,a;return Object(i.jsx)("td",{style:{height:100},className:"align-middle",title:(null===(t=e.summary)||void 0===t?void 0:t.length)>80?e.summary:"",children:e.summary.length>80?(null===(a=e.summary)||void 0===a?void 0:a.substring(0,77))+"...":null===e||void 0===e?void 0:e.summary})},type:function(e){return Object(i.jsx)("td",{className:"align-middle",children:e.type})},source:function(e){var t;return Object(i.jsx)("td",{className:"align-middle",children:Object(i.jsx)("a",{target:"_blank",href:e.source,children:e.source.length>80?(null===(t=e.source)||void 0===t?void 0:t.substring(0,77))+"...":null===e||void 0===e?void 0:e.source})})},created_date:function(e){return Object(i.jsx)("td",{className:"align-middle",children:e.created_date?u()(1e3*e.created_date).format("DD/MM/YYYY"):"-"})},action:function(e){return Object(i.jsx)("td",{className:"align-middle",children:Object(i.jsx)(d.d,{color:"primary",variant:"outline",shape:"square",size:"sm",style:{marginRight:10},onClick:function(){return H({show:!0,id:e.id})},children:Object(i.jsx)("i",{className:"fas fa-trash-alt",children:" "})})})}}})}),Object(C.h)(E.totalPages,p,(function(e){p!==e&&(o.push("?page=".concat(e)),Q(e,A))}),E.total)]})]})}},628:function(e,t,a){"use strict";var i=a(4);a(1);t.a=function(e){var t=e.className,a=e.label,n=e.children,c=e.width,l=e.centered,s=e.style;return c=c||110,Object(i.jsxs)("div",{className:"d-flex mb-3 ".concat(l?"align-items-center":""," ").concat(t||""),style:s,children:[Object(i.jsx)("div",{style:{minWidth:c,marginTop:6},children:a}),Object(i.jsx)("div",{style:{width:"calc(100% - ".concat(c,"px)")},children:n})]})}}}]);
//# sourceMappingURL=70.2b14cca5.chunk.js.map